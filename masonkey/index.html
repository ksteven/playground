<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>The Key</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <style>
    span.title {
      font-weight: bolder;
    }
  </style>
</head>

<body>
  <nav class="red darken-1" role="navigation">
    <div class="nav-wrapper"><a id="logo-container" href="#" class="brand-logo">&nbsp;The Key</a>
  </nav>

  <div id="main" class="">
    <div class="section">
      <div class="row">
        <div class="col s12">
          <div class="card">
            <div class="card-content">
              <image src="thekey.jpg" />
            </div>
          </div>
          <div class="card">
            <div class="card-content">
              <span class="card-title">Enter your word(s) here
              </span>
              <input placeholder="Enter the word" id="field1" />
            </div>
          </div>
          <div class="card">
            <div class="card-content">
              <span class="card-title">Result
              </span>
              <span id="result"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <p>Source: <a href="https://grahamhancock.com/leedsm1/">https://grahamhancock.com/leedsm1/</a> (<a
        href="https://archive.is/2og5Y">Archive</a>)</p>
  </footer>

  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

</body>
<script>
  // generate letter values
  let value = 1;
  let letter_value = new Map();
  let countdown = false;
  for (var letter = 65; letter < 91; letter++) {
    if (value % 7 === 0) {
      countdown = !countdown;
    }
    var _char = String.fromCharCode(letter);
    value = (value === 0) ? 1 : value;
    letter_value.set(_char, value);
    if (countdown) {
      value--;
    } else {
      value++;
    }
  }
  console.log(letter_value);

  function forceKeyPressUppercase(e) {
    console.log("do it");
    var charInput = e.keyCode;
    let thewords = "";
    let sumArray = [];

    thewords = document.getElementById("field1").value;
    // just in case
    thewords = thewords.toUpperCase();

    if (thewords.length > 0) {
      //now do the calculation
      let result = "";
      console.log("the words...." + thewords);
      let mywords = thewords.split(" ");
      mywords.forEach(theword => {
        if (theword.trim().length > 0) {
          let myletters = theword.split("");
          let sum = 0;
          result = result + "<br/>" + " <b>" + theword + "</b>";
          myletters.forEach(mychar => {
            let letter_val = letter_value.get(mychar);
            if (letter_val > 0) {
              sum += letter_val;
              result = result + "   " + "<sup>" + mychar + "</sup>&frasl;<sub>" + letter_val + "</sub>";///+ mychar + "(" + letter_val + ")";
            } else if (!Number.isNaN(mychar)) {
              sum += Number.parseInt(mychar);
            }
          });
          sumArray.push(sum);
          result = result + "  = <b>" + sum + "</b>";
        }
      });
      // add all the sums
      let sum = sumArray.reduce(function (a, b) {
        return a + b;
      }, 0);
      result = result + '<br/> <SPAN STYLE="text-decoration:overline; font-weight:bold">TOTAL: ' + sum + '</span>';
      document.getElementById("result").innerHTML = result;
    } else {
      document.getElementById("result").innerHTML = "";
    }
  }

  document.getElementById("field1").addEventListener("keypress", forceKeyPressUppercase, false);

  document.getElementById("field1").addEventListener("keyup", forceKeyPressUppercase, false);
</script>

</html>