<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		
		<title>WWG Fantasy</title>

		<link rel="stylesheet" type="text/css" href="../cdn.datatables.net/r/bs-3.3.5/jq-2.1.4%2cdt-1.10.8/datatables.min.css"/>
 
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        
		<script type="text/javascript" src="../cdn.datatables.net/r/bs-3.3.5/jqc-1.11.3%2cdt-1.10.8/datatables.min.js"></script>
		
		
		<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>
		
		<script type="text/javascript" charset="utf-8">
		 //utility function
		 function csvJSON(csv){

		  var lines=csv.split("\n");

		  var result = [];
		  
		  //\s|"
		  var headers=lines[0].split(",");

		  for(var i=1;i<lines.length;i++){

			  var obj = {};
			  var currentline=lines[i].split(',"')[0].replace('\s|"','').split(",");

			  for(var j=0;j<headers.length-1;j++){
				  obj[headers[j]] = currentline[j];
			  }
			  // add the array 
			  // var header = headers[headers.length-1].replace('"','');
			  // console.log(header);
			  obj.team = lines[i].split(',"')[1].split(",");
			  
			  result.push(obj);

		  }
		  
		  //return result; //JavaScript object
		  return result; //JSON
		}
		
		function checkAndParseArray(line){
		}
		 
		 //end utility 
		   $.ajax({
			  url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSA7MapmaniHJhQnuXhejZo5j42X5k_cqOsIc5AXW0jOgO1MQADUxuiDnJvfqzA1M_y3JgZP1_Ai1J4/pub?output=csv",
			 
			type: 'GET',
			crossDomain: true,
			dataType: 'text',
			success: function(d) { console.log(d); buildTables(d); },
			error: function(e) { console.log('Error', e); },
			//beforeSend: setHeader
			});
			
			function buildTables(data){
			  var json = csvJSON(data);
			  var outhtml = "";
			  console.log(json);
			  
			  for(var t of json){
			     var row = "<tr class='score_row'>"
				 +"<td>1</td>"
				 +"<td>"+t.name+"</td><td>"+t.user+"</td><td>0</td><td>0</td><td>0</td><td><a href='#"+t.user+"'  class='btn btn-primary'>Show</a></td>"
				 +"</tr>"
				 outhtml = outhtml + row; 
				 buildRosterTable(t);
			  }
			  $("#score_table").html(outhtml);
			}
			
			function buildRosterTable(team){
			   console.log('team', team);
			   var rosterhtml = '<div class="panel panel-default">'
			+'<div id="" class="panel-heading">'
			+ team.name + '<span class="player_name"> Owner:' + team.user + '</span></div>'
			+'<table class="table table-bordered"><thead>'
			+'<tr>'
			+'<th>Player Name</th>'
			+'<th>Posts</th>'
			+'<th>Rounds Survived</th>'
			+'<th>Kills</th> '
			+'<th>Score total</th>'
			+'</tr>'
			+'</thead>'
			+'<tbody>';
			
			for(p of team.team){
			   rosterhtml = rosterhtml +'<tr class="roster_stat"><td>'+p+'</td></tr>';
			}
			
			rosterhtml = rosterhtml + '</tbody></table></div>';
			   
			 $("#rosters").append(rosterhtml);
			}
		</script>
		<style>
		  .footer {
				bottom: 0;
				width: 100%;
				height: 60px;
				background-color: #f5f5f5;
			}
		</style>
		
	</head>
	<body>
		<div class="container">
		<div class="row"><h1><span class="pull-left">WWG Fantasy</span></h1>
		</div>
		<div class="row">
		<div class="">
		
		<br>
		<!-- Total Result Pane -->
		<div class="panel panel-primary">
        <div id="" class="panel-heading">Team Scoreboard<span class="player_name"></span></div>
		<table id="player_stats" class="table table-bordered"><thead>
		<tr>
		<th>Rank </th>
		<th>Team Name</th>
		<th>Owner</th>
		<th>Posts</th>
		<th>Rounds Survived</th> 
		<th>Kills</th> 
		<th>Team</th> 
		</tr>
		</thead>
		<tbody id="score_table">
		
		</tbody>
		</table>
		</div> <!-- /Total Result Pane -->
		<!-- Advanced stats -->
		<div id="">
		<!-- Human Result Pane -->
		<div class="panel panel-default">
        <div id="" class="panel-heading"><img src="http://www.braingle.com/games/werewolf/images/user.png" width="16" height="16" alt="h">  Individual Performance Stats <span class="player_name"></span></div>
		<table id="human_stats" class="table table-bordered"><thead>
		<tr>
		<th>Player Name</th>
		<th>Posts</th>
		<th>Rounds Survived</th>
		<th>Kills</th> 
		<th># of Teams</th>
		<th>Score total</th>
		</tr>
		</thead>
		<tbody>
		<tr id="human_stats_row" class="ww_stat">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		</tr>
		</tbody>
		</table>
		</div> <!-- /Human Result Pane -->
		
		<!-- WOLF Result Pane -->
		<h3>Rosters</h3>
		<span id="rosters">
			<!--- put rosters here -->
		</span>


	</body>

</html>