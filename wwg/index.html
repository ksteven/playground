<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		
		<title>WWG Data</title>

		<link rel="stylesheet" type="text/css" href="../cdn.datatables.net/r/bs-3.3.5/jq-2.1.4%2cdt-1.10.8/datatables.min.css"/>
 
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        
		<script type="text/javascript" src="../cdn.datatables.net/r/bs-3.3.5/jqc-1.11.3%2cdt-1.10.8/datatables.min.js"></script>
		
		
		<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.min.js"></script>
		
		<script type="text/javascript" charset="utf-8">
		var getArrayAvg = function(arr){
			var total = 0;
			var avg = 0;
			for(var i = 0; i < arr.length; i++) {
				total += arr[i];
			};
			avg = parseFloat(total / arr.length).toFixed(2);
			if(isNaN(avg))
			  avg = 0;
			
			return avg;
		};
		
			$(document).ready(function() {
				var table = $('#example').on( 'processing.dt', function ( e, settings, processing ) {
        $('#processingIndicator').css( 'display', processing ? 'block' : 'none' );
    } ).DataTable({
				   //"ajax": 'src/src.txt'
				   "ajax": "http://ksteven.github.io/wwg/src/src.txt",
				   initComplete:  function(){
				       this.api().columns().every( function (index) {
							var column = this;
							var select = $('<select class="footer-filter"><option value=""></option></select>')
								.appendTo( $(column.footer()).empty() )
								.on( 'change', function () {
									var val = $.fn.dataTable.util.escapeRegex(
										$(this).val()
									);
			 
									column
										.search( val ? '^'+val+'$' : '', true, false )
										.draw();
								} );
			 
							column.data().unique().sort().each( function ( d, j ) {
								select.append( '<option value="'+d+'">'+d+'</option>' )
							} );
							if(index ===1){
							  var select_box = select.clone();
							  select_box.addClass('search');
							 $('#search_in').html(select_box);
							 $(select_box).select2({minimumInputLength:3, placeholder: 'Enter a username'})
							    .change(function(){
									$('.footer-filter').not('.search').val("").change();
									var player_name = $(this).val();
									var regExSearch = "^"+player_name+"$";
									table.search(player_name).draw();
									table.columns(1).search(regExSearch, true).draw();
									$('.player_name').html(player_name);
				                   var total_games = table.rows({ search:'applied', page:'all' } ).data().length;
								   var wins = 0;
								   var losses = 0;
								   var mods = 0;
								   var wolf = 0;
								   var human = 0;
								   var seer = 0;
								   var human_games = 0;
								   var wolf_games = 0;
								   var seer_games = 0;
								   var survive = 0;
								   var h_shot_rd = new Array();
								   var h_eaten_rd = new Array();
								   var w_shot_rd = new Array();
								   var s_die_rd = new Array();
								   
								   table.rows({ search:'applied', page:'all' } ).data()
								   .each(function(value, index) {
										console.log(value);
										var role = value[2];
										var fate = value[3];
										var rd = value[4];
										var result = value[5];
										
										//if(fate == "Survived"){
										//  survive++; 
										//}
										
										if(role[0] == "M"){ //moderator
										  mods++;
										}else if(role[0] == "W"){ //wolf
										  wolf_games++;
										  if(role[0] == result[0]){
										    wins++;
											wolf++;
										  }else{
											losses++;
										  }
										  if(fate == "Survived"){
										    survive++; 
										  }else{
										    w_shot_rd.push(rd);
										  }
										}else if(role[0] == "H"){ //human
										  human_games++;
										  if(role[0] == result[0]){
										    wins++;
											human++;
										  }else{
											losses++;
										  }
										  if(fate == "Survived"){
										    survive++; 
										  }else if(fate=="Shot"){
										    h_shot_rd.push(rd);
										  }else{
										    h_eaten_rd.push(rd);
										  }
										}else if(role[0] == "S"){ //seer
										  seer_games++;
										  if(result.indexOf("H") > -1){
											  wins++;
											  seer++;
										  }else{
										      losses++;
										  }
										  if(fate == "Survived"){
										    survive++; 
										  }
										  s_die_rd.push(rd); 
										}
									});
									//player totals 
									total_games = total_games - mods; 
									
									var win_pct = parseFloat((wins/total_games)*100).toFixed(2);
									
									var sur_rate = parseFloat((survive/total_games)*100).toFixed(2);
									$('#stats_row').children('td').eq(0).html(total_games);
									$('#stats_row').children('td').eq(1).html(win_pct+'%');
									$('#stats_row').children('td').eq(2).html(wins);
									$('#stats_row').children('td').eq(3).html(losses);
									$('#stats_row').children('td').eq(4).html(sur_rate+'%');
									//$('#stats_row').children('td').eq(5).html(wolf);
									//$('#stats_row').children('td').eq(6).html(seer);
									
									//human totals
									if(human_games)
									win_pct = parseFloat((human/human_games)*100).toFixed(2);
									else 
									win_pct = 0;
									
									var best_pct =  win_pct;
									var best_role = "Human";
									$('#human_stats_row').children('td').eq(0).html(human_games);
									$('#human_stats_row').children('td').eq(1).html(win_pct+'%');
									$('#human_stats_row').children('td').eq(2).html(human);
									$('#human_stats_row').children('td').eq(3).html(parseInt(human_games-human));
									$('#human_stats_row').children('td').eq(4).html(getArrayAvg(h_shot_rd)+ " (Shot "+h_shot_rd.length+ " times)");
									$('#human_stats_row').children('td').eq(5).html(getArrayAvg(h_eaten_rd)+ " (Eaten "+h_eaten_rd.length+ " times)");
									
									//wolf totals
									if(wolf_games > 0)
									win_pct = parseFloat((wolf/wolf_games)*100).toFixed(2);
									else
									win_pct = 0;
									
									if(win_pct > best_pct){
									best_pct = win_pct; 
									best_role="Wolf";}
									$('#wolf_stats_row').children('td').eq(0).html(wolf_games);
									$('#wolf_stats_row').children('td').eq(1).html(win_pct+'%');
									$('#wolf_stats_row').children('td').eq(2).html(wolf);
									$('#wolf_stats_row').children('td').eq(3).html(parseInt(wolf_games-wolf));
									$('#wolf_stats_row').children('td').eq(4).html(getArrayAvg(w_shot_rd)+ " (Shot "+w_shot_rd.length+ " times)");
									
									//seer totals
									if(seer_games > 0)
									win_pct = parseFloat((seer/seer_games)*100).toFixed(2);
									else
									win_pct = 0;
									
									if(seer_games > 0 && win_pct > best_pct){
									best_pct = win_pct; 
									best_role="Seer";}
									$('#seer_stats_row').children('td').eq(0).html(seer_games);
									$('#seer_stats_row').children('td').eq(1).html(win_pct+'%');
									$('#seer_stats_row').children('td').eq(2).html(seer);
									$('#seer_stats_row').children('td').eq(3).html(parseInt(seer_games-seer));
									$('#seer_stats_row').children('td').eq(4).html(getArrayAvg(s_die_rd));
									
									//best role
									$('#stats_row').children('td').eq(5).html(best_role + " ("+best_pct+"%)");
							  });//end change
							}
						} );  //every select for column
						} //init
				});
			
				$('#clear').click(function(){
				   console.log("clear");
				   $('.search').select2("val", "");
				   table.search( '' )
					 .columns().search( '' )
					 .draw('full-reset');
				   $('.ww_stat').children('td').html('');
				   $('.player_name').html('');
				});			
				
				
			} );
		</script>
		<style>
		  .footer {
				bottom: 0;
				width: 100%;
				height: 60px;
				background-color: #f5f5f5;
			}
		</style>
		
	</head>
	<body>
		<div class="container">
		<div class="row"><h1><span class="pull-left">WWG Database</span><div class="" style="">&nbsp;&nbsp;<button id="clear" type="button" class="btn btn-info"><span class="glyphicon glyphicon-refresh"></span> Clear All</button></div></h1>
		</div>
		<div class="row">
		<h3>Player Statistics Search 
		</h3> 
		<div class="">
		<div class="well input-group">
		  <label style="margin-right: 10px;">Player Name</label>
		  <span id="search_in">
		    <div class="alert alert-info"><strong>Data is loading... Please wait.</strong></div>
		  </span>
		</div><!-- /input-group -->
		
		<br>
		<!-- Total Result Pane -->
		<div class="panel panel-primary">
        <div id="" class="panel-heading">Total Stats: <span class="player_name"></span></div>
		<table id="player_stats" class="table table-bordered"><thead>
		<tr>
		<th>Total Games Played</th>
		<th>Win %</th>
		<th>Wins</th><th>Losses</th> 
		<th>Survival Rate</th> 
		<th>Best Role</th> 
		</tr>
		</thead>
		<tbody>
		<tr id="stats_row" class="ww_stat"><td></td><td></td><td></td><td></td><td></td><td></td></tr>
		</tbody>
		</table>
		</div> <!-- /Total Result Pane -->
		<!-- Advanced stats -->
		<div id="">
		<!-- Human Result Pane -->
		<div class="panel panel-default">
        <div id="" class="panel-heading"><img src="http://www.braingle.com/games/werewolf/images/user.png" width="16" height="16" alt="h">  Human Stats: <span class="player_name"></span></div>
		<table id="human_stats" class="table table-bordered"><thead>
		<tr>
		<th>Human Games Played</th>
		<th>Human Win %</th>
		<th>Wins</th>
		<th>Losses</th> 
		<th>Avg. Round Shot</th>
		<th>Avg. Round Eaten</th>
		</tr>
		</thead>
		<tbody>
		<tr id="human_stats_row" class="ww_stat">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		</tr>
		</tbody>
		</table>
		</div> <!-- /Human Result Pane -->
		
		<!-- WOLF Result Pane -->
		<div class="panel panel-default">
        <div id="" class="panel-heading"><img src="http://www.braingle.com/games/werewolf/images/wolf.gif" width="16" height="16" alt="w"> Wolf Stats: <span class="player_name"></span></div>
		<table id="wolf_stats" class="table table-bordered"><thead>
		<tr>
		<th>Wolf Games Played</th>
		<th>Wolf Win %</th>
		<th>Wins</th>
		<th>Losses</th> 
		<th>Avg. Round Shot</th>
		</tr>
		</thead>
		<tbody>
		<tr id="wolf_stats_row" class="ww_stat">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		</tr>
		</tbody>
		</table>
		</div> <!-- /WOLF Result Pane -->
		
		<!-- SEER Result Pane -->
		<div class="panel panel-default">
        <div id="" class="panel-heading"><img src="http://www.braingle.com/games/werewolf/images/wand.png" width="16" height="16" alt="s"> Seer Stats: <span class="player_name"></span></div>
		<table id="seer_stats" class="table table-bordered"><thead>
		<tr>
		<th>Seer Games Played</th>
		<th>Seer Win %</th>
		<th>Wins</th>
		<th>Losses</th> 
		<th>Avg. Round Caught</th>
		</tr>
		</thead>
		<tbody>
		<tr id="seer_stats_row" class="ww_stat">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		</tr>
		</tbody>
		</table>
		</div> <!-- /WOLF Result Pane -->
		</div> <!-- /advanced stats  -->
		</div>
		
		</div>
		<div class="row">
		<h3>Game Statistics</h3>
		<table id="example" class="display" cellspacing="0" width="100%">
		<thead>
		<tr><th>Game No.</th><th>Player</th><th>Role</th><th>Fate</th><th>Round</th><th>Outcome</th><th>Total Game Rounds</th></tr></thead>
		</tbody>
		<tfoot><tr><th>Game No.</th><th>Player</th><th>Role</th><th>Fate</th><th>Round</th><th>Outcome</th><th>Total Game Rounds</th></tr></tfoot>
		</table>
		</div>
		
		</div>

<script type="text/javascript">
	// For demo to fit into DataTables site builder...
	$('#example')
		.removeClass( 'display' )
		.addClass('table table-striped table-bordered');
</script>
	</body>
	<footer class="footer"><div class="container"><div class="row"><p>Raw Data: <a href=" https://docs.google.com/spreadsheets/d/1SWVQIpgj1EtRgpvDVFi3Bv5NLNvSThB50gPFvTqB-7g/edit?usp=sharing"> Available Here </a></p>
	<p>Last Update April 04</p>
	</div></div></footer>

</html>