<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js"
     integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c" crossorigin="anonymous"></script>

    <title>Player Rating DB</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css">
  </head>

  <body>

    <nav class="navbar navbar-expand-sm navbar-dark bg-primary mb-3">
        <div class="container">
            <a class="navbar-brand" href="/">Player Rating DB</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                        
                        <li class="nav-item">
                        <a href="#" class="nav-link">Logout</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>

    <main role="main" class="container">

      <div class="container">
         <div class="row">
            </div>
            <div class="row">
                <div class=" col">
                    <form id="sim_form" class="card bg-light card-body mb-3 ">
                        <!--Health, Stamina, Agility, Handicraft, Navigation, Intelligence, Shooting
                        , Strength, Social, Stealth-->
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Name</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" id="h_name" type="text">
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Health</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" placeholder="50"
                                value="50" type="number">
                            </div>
                            <label class="col-sm-2 col-form-label">Stamina</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                        </div>
                        <!-- /input-group -->
                            <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Agility</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                            <label class="col-sm-2 col-form-label">HC</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Nav</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                            <label class="col-sm-2 col-form-label">Intelligence</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Shooting</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                            <label class="col-sm-2 col-form-label">Shooting</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label">Social</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                            <label class="col-sm-2 col-form-label">Stealth</label>
                            <div class="col-sm-4">
                                <input class="human_stat form-control" min="0" max="100" value="50" type="number">
                                
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class=" form-group row">
                            <label style="color:red" class="col-sm-2 col-form-label">Total</label>
                            <div class="col-sm-20">
                                <input id="total" type="number" value="500" disabled class="form-control">
                            </div>
                        </div>
                        <!-- /input-group -->
                        <div class="form-group">
                            <div class="offset-sm-2 col-md-10">
                                <button id="save" type="button" class="btn btn-info">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- /col -->
            </div>
            <!-- /row -->
            <div class="row">
                <table id="char_table" class="table table-striped">
                    <thead>
                        <tr>
                            <th>Player Name</th>
                            <th>Health</th>
                            <th>Stamina</th>
                            <th>Agility</th>
                            <th>Handcraft</th>
                            <th>Navigation</th>
                            <th>Intelligence</th>
                            <th>Shooting</th>
                            <th>Strength</th>
                            <th>Social</th>
                            <th>Stealth</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="btn btn-danger float-right" onclick="if(confirm(&apos;Sure?&apos;))localStorage.clear();">Delete All</button>
            </div>
        </div>
        <!-- /row -->
      </div>

    </main><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script>
	<script src="https://github.com/typicaljoe/taffydb/raw/master/taffy.js"></script>
	<script>
	
	   var players = TAFFY(); // localStorage.getItem('rpg_chars');
	   
	   //Health, Stamina, Agility, Handcraft, Navigation, Intelligence, Shooting , Strength, Social, Stealth
	   function createPlayer(Name, Health, Stamina, Agility, Handcraft
	   , Navigation, Intelligence, Shooting , Strength, Social, Stealth)
	   {  
	      var newplayer = {
		    name: Name,
		    health: Health,
			stamina: Stamina,
			agility: Agility,
			handcraft: Handcraft,
			navigation: Navigation,
			intelligence: Intelligence,
			shooting: Shooting,
			strength: Strength,
			social: Social,
			stealth: Stealth
		  };
	       
		   return newplayer; 
	   };
	
	   if(players){
	     playarr = players().get();
		 
		 for(var c in playarr){
		    var player = playarr[c];
			
			if(player && !jQuery.isEmptyObject(player)){
			    //insert tr 
				var row = "<tr><td>"+player.name+"</td><td>"+player.health+"</td><td>"+player.stamina
				+"</td><td>"+player.agility+"</td><td>"+player.handcraft+"</td><td>"+player.navigation
				+"</td><td>"+player.intelligence+"</td><td>"+player.shooting+"</td><td>"+player.strength
				+"</td><td>"+player.social+"</td><td>"+player.stealth+"</td><td><button class='btn load'>LOAD</button></td></tr>";
				
				$('#char_table > tbody:last-child').append(row);
			};
		 };
	   };
	   
	   $('.load').click(function(){
	     var tr = $(this).parents('tr');
		 
		 $(tr).children('td').each(function(index){
		   var tdval = $(this).html();
		   $(".human_stat").eq(index).val(tdval); 
		 });
		 $(".human_stat").change();
	   });
	   
	   $('#save').click(function(){
	       /*var players = localStorage.getItem('rpg_chars');
		   if(players){
			 players = JSON.parse(players); 
		   }else{
			 players = new Array();
		   };*/
		   
		   var human_stats = $(".human_stat").map(function() { return this.value; }).get();
		   console.log(human_stats);
		   var player = createPlayer(human_stats[0], human_stats[1], human_stats[2], human_stats[3], human_stats[4]
		   , human_stats[5], human_stats[6], human_stats[7] , human_stats[8], human_stats[9], human_stats[10]);
		   
		   /*players.push(player);
		   console.log(players);
		   localStorage.setItem('rpg_chars', JSON.stringify(players));*/
		   players.insert(player);
		   location.reload();
	   });
	   
	   $('#calculate').click(function(){
	      var isSuccessful = true; 
		  var alertReturn = "";
	      
		  $('#sim_form').find("input:checked").each(function(){
		      var label = $(this).parent().siblings(".control-label").text(); 
		      var checkedVal = $(this).siblings("input[type='number']").val(); 
			  var random = Math.floor((Math.random() * 100) + 1);
			  var diff = 0;
			  diff = checkedVal - random;
			  
			  if(random > checkedVal){ //this failed 
			    isSuccessful = false; 
			    alertReturn = alertReturn + ""+label+ " with score "+checkedVal+ " failed due to result "+random 
				+ ". Difference is <strong>"+diff+"</strong> <br/>";
			  }else{ //this succeeds  
			     alertReturn = alertReturn + " "+label+ " with score "+checkedVal+ " succeeded with result "+random 
				 + ". Difference is <strong>"+diff+"</strong> <br/>";
			  }
		   });
		   
		   if(isSuccessful && alertReturn.length  > 1){
		      alertReturn = "<strong>Action Successful!</strong> <br/>" + alertReturn;
			  $('#results').removeClass('alert-info');
			  $('#results').removeClass('alert-danger');
			  $('#results').addClass('alert-success');
		   }else{
		      alertReturn = "<strong>Action Failed!</strong> <br/>" + alertReturn;
			  $('#results').removeClass('alert-info');
			  $('#results').removeClass('alert-success');
			  $('#results').addClass('alert-danger');
		   };
		   
		   $('#results').html(alertReturn);
	   });
	   
	   $(".human_stat").change(function(){
	      
		  var human_stats = $("input.human_stat[type='number']").map(function() { return this.value; }).get();
		  var sum = 0;
		  
		  for(var h in human_stats){
		    var val = parseInt(human_stats[h]);
			if(val > 0){
			   sum= sum+ val;
			};
		  };
		  
	     $('#total').val(sum);
	   });
	</script> 
  </body>
</html>
