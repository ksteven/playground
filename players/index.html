<!doctype html>
<html lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content=""><meta name="author" content=""><script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js"
     integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c" crossorigin="anonymous"></script>
	<title>Player Rating DB</title>
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet" /><!-- Custom styles for this template -->
	<link href="css/style.css" rel="stylesheet" />
	
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/r-2.2.2/datatables.min.css"/>
	<link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" rel="stylesheet" />
</head>
<body>
<nav class="navbar navbar-expand-sm navbar-dark bg-primary mb-3">
<div class="container"><a class="navbar-brand" href="#">Player Rating DB</a><button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarNav" data-toggle="collapse" type="button"></button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav">
	<li class="nav-item"><a class="nav-link" href="#">Home</a></li>
</ul>

<ul class="navbar-nav ml-auto">
	<li class="nav-item"><a class="nav-link" href="admin.html">Login</a></li>
</ul>
</div>
</div>
</nav>
<main class="container" role="main">
<div class="container">
<div class="row">
<table class="table table-striped" id="play_table">
	<thead>
		<tr>
			<th>Player Name</th>
			<th>Health</th>
			<th>Stamina</th>
			<th>Athleticism</th>
			<th>Handling</th>
			<th>Rebounding</th>
			<th>IQ</th>
			<th>Shooting</th>
			<th>Hustle</th>
			<th>Passing</th>
			<th>Defense</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>
</div>
</div>
<!-- /row --></main>
<!-- /.container --><!-- Bootstrap core JavaScript
    ================================================== --><!-- Placed at the end of the document so the pages load faster --><script src="js/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script><script src="js/bootstrap.min.js"></script><script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script><script src="js/taffy.js"></script>
	
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/r-2.2.2/datatables.min.js"></script>
	<script>
	   localStorage.setItem("loggedIn", "false"); // set user logged out
	   var valid = true; 
	   var players = TAFFY(); 
	   
	   // players.store("players"); // starts storing records in local storage
	   var table = $("#play_table").DataTable({
	   responsive: true,
	   });
		
	   players.store("players");
	   loadTable();
	   
	   //Health, Stamina, athleticism, Handling, Rebounding, IQ, Shooting , Hustle, Passing, Defense, Hustle
	   function createPlayer(Id, Name, Health, Stamina, Athleticism, Handling
	   , Rebounding, IQ, Shooting , Hustle, Passing, Defense)
	   {  
	      var newplayer = {
		    id: Id,
		    name: Name,
		    health: Health,
			stamina: Stamina,
			athleticism: Athleticism,
			rebounding: Rebounding,
			handling: Handling,
			defense: Defense,
			iq: IQ,
			hustle: Hustle,
			shooting: Shooting,
			passing: Passing,


		  };
	       
		   return newplayer; 
	   };

       $('input[type="number"]').change(function(e)  {
          var value = $(this).val();
          console.log($(this).val()); 
          if(value > 100){
                  alert("value is too high!"); 
				  return valid = false; 
            } else if (value < 0){
			alert("value is too low"); 
			return valid = false; 
          }
		  return valid = true; 
       });
	
	 function loadTable(){
	   console.log("do load");
	   table.clear().draw();
	   if(players){
	     players().order("name").each(function (player) {
		 console.log("player to add ", player);
                       
		var rowNode = table.row.add([player.name, player.health, player.stamina, player.athleticism,player.handling, player.rebounding
				,player.iq,player.hustle,player.shooting
				,player.passing,player.defense, ]).draw().node();
		 $( rowNode ).attr( 'data-id', player.id );
		 
		 });
	   }
			table.draw();
	  }
	  
	  function editRow(e){
	     var tr = $(e).parents('tr');
		 console.log(tr);
		 var id = $(tr).data('id');
		 console.log("got id", id);
		 $("#h_id").val(id); 
		 $(tr).children('td').each(function(index){
		   var tdval = $(this).html();
		   $(".player_stat").eq(index).val(tdval); 
		 });
		 $(".player_stat").change();
	  }
	  
	  function removeRow(e){
	     var tr = $(e).parents('tr');
		 console.log(tr);
		 var Id = $(tr).data('id');
		 players({id:Id}).remove();
		 loadTable();
	  }
	    
	   // $('.load').on("click", editRow );
	   $("#delete_all").click(function(){
	      if(confirm('Sure?')){
		     localStorage.clear();
			 window.location.reload();
		  }
	   });
	   
	   $('#save').click(function(){
	       if(!valid){
		      return false; // exit function, data invalid 
		   }
	       /*var players = localStorage.getItem('');
		   if(players){
			 players = JSON.parse(players); 
		   }else{
			 players = new Array();
		   };*/
		   // console.log();
		   var newItemId = 0;
		   if(players().get().length > 0){
				var highestId = players().max("id");
                            //New item's id is one more.
                newItemId = highestId + 1;
		   }
		   var player_stats = $(".player_stat").map(function() { return this.value; }).get();
		   console.log(player_stats);
		   var player = createPlayer(newItemId, player_stats[0], player_stats[1], player_stats[2], player_stats[3], player_stats[4]
		   , player_stats[5], player_stats[6], player_stats[7] , player_stats[8], player_stats[9], player_stats[10]);
		   
		   console.log(player);
		   players.insert(player);
		   var rowNode = table.row.add([player.name, player.health, player.stamina, player.athleticism,player.handling, player.rebounding
				,player.iq,player.shooting,player.hustle
				,player.passing,player.defense, ]).draw().node();
		   $( rowNode ).attr( 'data-id', newItemId );
		   table.draw();
	   });
	   
	   $('#update').click(function(){
	       if(!valid){
		      return false; // exit function, data invalid 
		   }
	       /*var players = localStorage.getItem('');
		   if(players){
			 players = JSON.parse(players); 
		   }else{
			 players = new Array();
		   };*/
		   // console.log();
		   var Id = parseInt($("#h_id").val());
		   console.log("UPDate for ", Id);
		   var player_stats = $(".player_stat").map(function() { return this.value; }).get();
		   console.log(player_stats);
		   var player = createPlayer(Id, player_stats[0], player_stats[1], player_stats[2], player_stats[3], player_stats[4]
		   , player_stats[5], player_stats[6], player_stats[7] , player_stats[8], player_stats[9], player_stats[10]);
		   
		   /*players.push(player);
		   console.log(players);
		   localStorage.setItem('rpg_chars', JSON.stringify(players));*/
		   // players({id:Id}).remove();
		   players({id:Id}).update(player);
		   /*var rowNode = table.row.add([player.name, player.health, player.stamina, player.athleticism,player.handling, player.rebounding
				,player.iq,player.shooting,player.hustle
				,player.passing,player.defense, ]).draw().node();*/
		   // $( rowNode ).attr( 'data-id', newItemId );
		   table.clear().draw();
		   loadTable();
	   });
	   
	   $(".player_stat").change(function(){
	      
		  var player_stats = $("input.player_stat[type='number']").map(function() { return this.value; }).get();
		  var sum = 0;
		  
		  for(var h in player_stats){
		    var val = parseInt(player_stats[h]);
			if(val > 0){
			   sum= sum+ val;
			};
		  };
		  
	     $('#total').val(sum);
	   });	   
	</script>
</body>
</html>